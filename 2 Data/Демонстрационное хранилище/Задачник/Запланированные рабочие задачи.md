---
created: 2024-06-16 04:55:38 (+04:00), Sunday
updated: 2024-06-16 04:58:11 (+04:00), Sunday
---

```dataviewjs
const tasksOutput = dv.pages("#workingTask")
  .flatMap(page => { // Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾ Ð½Ð° flatMap Ð´Ð»Ñ ÑÐ±Ð¾Ñ€Ð° Ð·Ð°Ð´Ð°Ñ‡ Ð¸Ð· Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð² Ð¾Ð´Ð¸Ð½ Ð¼Ð°ÑÑÐ¸Ð²
    function findAllUncompletedTasksWithDates(tasks, currentPath) {
      let allTasks = []; // ÐœÐ°ÑÑÐ¸Ð² Ð´Ð»Ñ ÑÐ±Ð¾Ñ€Ð° Ð²ÑÐµÑ… Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡
      for (const task of tasks) {
        const executionDateMatch = task.text.match(/â³\s(\d{4}-\d{2}-\d{2})/) || task.text.match(/ðŸ›«\s(\d{4}-\d{2}-\d{2})/);
        if (!task.checked && task.annotated && executionDateMatch) {
            const executionDate = new Date(`${executionDateMatch[1]}T00:00:00-00:00`);
            const userTimeZoneOffset = 4 * 60; // Ð£ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÑÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ UTC+4
            const currentDate = new Date();
            currentDate.setMinutes(currentDate.getMinutes() + currentDate.getTimezoneOffset() + userTimeZoneOffset);
            if (executionDate >= currentDate) { // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð°Ñ‚Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
              allTasks.push({
                task: task.text,
                path: currentPath,
                created: task.created,
                executionDate: executionDate
              });
          }
          // Ð ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ð¾ Ð¸Ñ‰ÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð² Ð¿Ð¾Ð´Ð·Ð°Ð´Ð°Ñ‡Ð°Ñ…
          if (task.subtasks && task.subtasks.length > 0) {
            allTasks = allTasks.concat(findAllUncompletedTasksWithDates(task.subtasks, currentPath));
          }
        }
      }
      return allTasks;
    }

    return findAllUncompletedTasksWithDates(page.file.tasks, page.file.name).map(taskDetails => {
      const fileName = taskDetails.path.split('/').pop().replace('.md', '');
      let priority = Number(page['ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚']);

      return {
        task: `[[${fileName}]]`,
        step: taskDetails.task
            .replace(/^\[\s\]\s/, "") // Ð£Ð´Ð°Ð»ÑÐµÑ‚ "- [ ] " Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸
            .replace(/([ðŸ·ï¸âž•ðŸ›«â³])\s*\d{4}-\d{2}-\d{2}/g, "$1") // Ð£Ð´Ð°Ð»ÑÐµÑ‚ Ð´Ð°Ñ‚Ñ‹, ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ Ð·Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ñ‹Ð¼Ð¸ ÑÐ¼Ð¾Ð´Ð·Ð¸
			.replace(/ðŸ” every.*day.*/g, "")
			.replace(/ðŸ” every.*week.*/g, "")
			.replace(/ðŸ” every.*month.*/g, "")
            .replace(/\s?[ðŸ·ï¸âž•ðŸ›«â³]\s?/g, "") // Ð£Ð´Ð°Ð»ÑÐµÑ‚ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¼Ð¾Ð´Ð·Ð¸ Ñ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ð°Ð¼Ð¸ Ð¿Ð¾ Ð±Ð¾ÐºÐ°Ð¼
            .trim(), // Ð£Ð´Ð°Ð»ÑÐµÑ‚ Ð»Ð¸ÑˆÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±ÐµÐ»Ñ‹ Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ Ð¸ ÐºÐ¾Ð½Ñ†Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸
        reason: page['Ð—Ð°Ñ‡ÐµÐ¼'],
        executionDate: taskDetails.executionDate,
        priority: priority,
        created: taskDetails.created,
      };
    });
  })
  .filter(task => task !== null);

if (tasksOutput.length > 0) {
  dv.table(
    ["ðŸŽ¯", "ðŸ¾", "Start_Date", "ðŸš¦", "ðŸŒŸ"],
    tasksOutput
    .sort(task => Number(task.priority), "desc")
    .sort(task => Number(task.executionDate), "asc")
    .map(task => [task.task, task.step, task.executionDate.toISOString().slice(0, 10), task.priority, task.reason])
  );
}

```